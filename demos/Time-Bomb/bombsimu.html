<html>

<head>
</head>

<body>

<script>
  var startTickAfterSecs = 3;
  var blastInSecs = 7;
  var oneSec = 1000;

  var timeoutId, intervalId;

  var bombBlast = function() {
    console.log(blastInSecs); // print final '1'
    alert("KABOOM!!!");
  }

  var bombStatus = function() {
    console.log(blastInSecs--);
  }

  var bombStartTicking = function() {
    ans = confirm("The bomb will now start ticking.\n\n" +
    "It will go off after " + blastInSecs + " seconds unless you manage to press the right keyboard key.\n\n" +
    "You okay with that, champ?");

    if (ans) {
      timeoutId = setTimeout(bombBlast, blastInSecs * oneSec);
      intervalId = setInterval(bombStatus, oneSec);

      document.body.addEventListener("keydown", function(event) {
        var keyCode = event.keyCode;
        if (keyCode == 68) { // the 'D' key
          alert("Bomb defused successfully " + blastInSecs + " second" + ((blastInSecs > 1) ? "s" : "") + " before the blast.");
          clearTimeout(timeoutId);
          clearInterval(intervalId);
        }});
    }
  }

  alert("The bomb starts ticking after " + startTickAfterSecs + " seconds.");
  setTimeout(bombStartTicking, 3 * oneSec );

</script>

</body>

</html>
